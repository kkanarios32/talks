\ProvidesPackage{beamerthemekellentheme}

\RequirePackage{fontspec}
\RequirePackage{graphicx}
\RequirePackage{tcolorbox}
\RequirePackage{natbib}     % For formatting references

\setcitestyle{authoryear,round,citesep={;},aysep={,},yysep={;}}

\usefonttheme{serif}

% Font and color
\defaultfontfeatures{Scale=MatchLowercase}
% \setmainfont{Literata-Regular.ttf}[
%     path = ./fonts/,
%     BoldFont = Literata-Bold.ttf,
%     ItalicFont = Literata-Italic.ttf,
%     BoldItalicFont = Literata-BoldItalic.ttf ]
\setmainfont{FacebookSansRegular.ttf}[
    path = ./fonts/,
    BoldFont = FacebookSansBold.ttf,
    ItalicFont = FacebookSansItalic.ttf,
    BoldItalicFont = FacebookSansBoldItalic.ttf ]

% Define custom colors
\definecolor{blue}{RGB}{0,39,76}
\definecolor{maize}{RGB}{255,203,5}
\definecolor{red}{RGB}{154,51,36}
\definecolor{green}{RGB}{117,152,141}
\definecolor{orange}{RGB}{216,96,24}

% Define a macro for a colored block
\newtcolorbox{coloredblock}[1]{%
  colframe=#1,        % Border color
  coltitle=#1,        % Title text color
  colback=white,      % Background color
  colbacktitle=white,    % Title background color
  coltext=#1,         % Body text color
  boxrule=1pt,         % Border width
  arc=1mm,               % Rounded corners (optional)
  left=1mm, right=1mm, top=1mm, bottom=1mm,
  fonttitle=\bfseries,
}

% Convenience macro
\NewDocumentCommand{\colorblock}{m o o m}{%
  \IfValueTF{#2}{%
  \begin{coloredblock}{#1}{
      \IfValueTF{#3}{#3}{\relax}%
      \color{#1} \textbf{#2}.
      #4
  }\end{coloredblock}%
  }{
  \begin{coloredblock}{#1}{
      \IfValueTF{#3}{#3}{\relax}%
      \color{#1}
      #4 \\
  }\end{coloredblock}%
  }
}

% Set TOC appearance
\setbeamertemplate{section in toc}[circle]
\setbeamertemplate{subsection in toc}[square]
\setbeamerfont{subsection in toc}{size=\footnotesize}

\setbeamercolor{section in toc}{fg=blue}
\setbeamercolor{subsection in toc}{fg=gray}

% \oddsidemargin 0.0in            % Set the left margin for odd-numbered pages to 0.5 inches.
% \evensidemargin 0.3in           % Set the left margin for even-numbered pages to match the odd-numbered pages (for double-sided documents).
% \marginparwidth 0in             % Disable margin notes by setting the margin width to 0.
% \textheight 9.0 true in         % Define the height of the text area, including footnotes and figures, to be 9 inches.
% \textwidth 6.0 true in          % Define the width of the text area to be 5.5 inches.
% \widowpenalty=10000             % Prevent single lines (widows) at the top of a page by assigning a high penalty.
% \clubpenalty=10000              % Prevent single lines (orphans) at the bottom of a page by assigning a high penalty.
% \flushbottom                    % Align the text at the bottom of each page to give pages a consistent length.
% \sloppy                         % Allow LaTeX more flexibility in line-breaking to reduce overfull lines (long lines extending into the margins).

% Set beamer colors
\setbeamercolor{frametitle}{bg=white, fg=blue}
\setbeamerfont{frametitle}{series=\bfseries, shape=\itshape, size=\large}
\setbeamercolor{title}{fg=blue}
\setbeamercolor{structure}{fg=blue}
\setbeamercolor{item}{fg=blue}

\RequirePackage{etoolbox}
\RequirePackage[font=footnotesize,labelfont=bf]{caption}
\captionsetup{justification=centering}

% Set no indent and 5pt spacing globally
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt}

% Fix indent after common environments
\AtEndEnvironment{equation}{\noindent}
\AtEndEnvironment{equation*}{\noindent}
\AtEndEnvironment{displaymath}{\noindent}
\AtEndEnvironment{align}{\noindent}
\AtEndEnvironment{align*}{\noindent}
\AtEndEnvironment{itemize}{\noindent}
\AtEndEnvironment{enumerate}{\noindent}
\AtEndEnvironment{tcolorbox}{\noindent}
\AtEndEnvironment{quote}{\noindent}
\AtEndEnvironment{center}{\noindent}
\AtEndEnvironment{coloredblock}{\vskip 5pt}

% Customize frametitle
\setbeamertemplate{title page}{
  \begin{flushleft}
    \vspace*{-0.6in}
    \hspace*{-0.3in}
    \vspace*{0.2in}
    \includegraphics[width=0.2\linewidth]{figures/umich-crest.png}
    % Optional top rule
    \rule{\textwidth}{0.8pt}\par\vspace{0.5em}

    {\usebeamerfont{title}\usebeamercolor[fg]{title}\textbf{\inserttitle}\par}
    \vspace{0.8em}

    {\footnotesize \usebeamerfont{author}\usebeamercolor[fg]{author}\insertauthor\par}
    \vspace{0.2em}
    {\footnotesize \usebeamerfont{date}\usebeamercolor[fg]{date}\insertdate\par}

    % Optional bottom rule
    \vspace{1em}
    \rule{\textwidth}{0.8pt}
  \end{flushleft}
}


% Remove navigation symbols
\setbeamertemplate{navigation symbols}{}
\setbeamertemplate{headline}{}

\defbeamertemplate*{footline}{myfootline}{
\ifnum \insertpagenumber=1

\leavevmode%
\hbox{%
\begin{beamercolorbox}[wd=\paperwidth,ht=.80ex,dp=1ex,center]{}%
% empty environment to raise height
\end{beamercolorbox}}%
\vskip0pt%
\else
  \vspace*{-5pt}
\hspace*{.5cm}\Tiny{%
  \hfill(\insertframenumber/\inserttotalframenumber)\hspace*{5pt}
}%
\vspace*{10pt}
\fi
}
